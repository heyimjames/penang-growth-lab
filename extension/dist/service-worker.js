chrome.action.onClicked.addListener(e=>{e.id&&chrome.sidePanel.open({tabId:e.id})});chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0});chrome.runtime.onMessage.addListener((e,s,r)=>{if(e.type==="GET_CURRENT_TAB")return chrome.tabs.query({active:!0,currentWindow:!0},o=>{o[0]&&r({tab:o[0]})}),!0;if(e.type==="GET_AUTH_STATUS")return chrome.storage.local.get(["user","access_token"],o=>{const t=!!(o.user&&o.access_token);r({authenticated:t,user:o.user||null})}),!0;if(e.type==="AUTH_CALLBACK"){const{access_token:o,refresh_token:t,user:n}=e.payload;return chrome.storage.local.set({access_token:o,refresh_token:t,user:n},()=>{console.log("NoReply: Auth tokens stored successfully"),chrome.runtime.sendMessage({type:"AUTH_STATE_CHANGED",user:n}),r({success:!0})}),!0}if(e.type==="LOGOUT")return chrome.storage.local.remove(["access_token","refresh_token","user"],()=>{console.log("NoReply: Logged out"),chrome.runtime.sendMessage({type:"AUTH_STATE_CHANGED",user:null}),r({success:!0})}),!0});chrome.runtime.onInstalled.addListener(e=>{e.reason==="install"?console.log("NoReply extension installed"):e.reason==="update"&&console.log("NoReply extension updated to version",chrome.runtime.getManifest().version)});
